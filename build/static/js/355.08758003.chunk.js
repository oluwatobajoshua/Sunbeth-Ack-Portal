"use strict";(self.webpackChunksunbeth_portal_react_ts=self.webpackChunksunbeth_portal_react_ts||[]).push([[355],{5355:(e,t,a)=>{a.r(t),a.d(t,{default:()=>i});var n=a(5043),s=a(579);const i=()=>{const[e,t]=(0,n.useState)(""),[a,i]=(0,n.useState)("setup"),[r,o]=(0,n.useState)(""),[l,d]=(0,n.useState)(""),[c,h]=(0,n.useState)(""),[u,m]=(0,n.useState)(null),[y,p]=(0,n.useState)(!1);n.useEffect(()=>{const e=new URLSearchParams(window.location.search);t(e.get("email")||"")},[]);const x=async()=>{m(null),p(!0);try{const t=await fetch("/api/external-users/mfa/setup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),a=await t.json();if(!t.ok)throw new Error(a.error||"Failed to start MFA setup");o(a.secret),d(a.otpauth),i("verify")}catch(t){m(t.message||"Failed to start MFA setup")}finally{p(!1)}},f=async t=>{t.preventDefault(),m(null),p(!0);try{const t=await fetch("/api/external-users/mfa/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,code:c})}),a=await t.json();if(!t.ok)throw new Error(a.error||"Failed to verify code");i("done")}catch(t){m(t.message||"Failed to verify code")}finally{p(!1)}};return"done"===a?(0,s.jsxs)("div",{className:"container",style:{maxWidth:400,margin:"0 auto",padding:32},children:[(0,s.jsx)("h2",{children:"MFA Enabled"}),(0,s.jsx)("div",{children:"MFA is now enabled for your account. You may now log in."}),(0,s.jsx)("a",{href:"/login",children:(0,s.jsx)("button",{className:"btn",style:{marginTop:16},children:"Go to Login"})})]}):"setup"===a?(0,s.jsxs)("div",{className:"container",style:{maxWidth:400,margin:"0 auto",padding:32},children:[(0,s.jsx)("h2",{children:"Enable MFA"}),(0,s.jsx)("div",{style:{marginBottom:16},children:(0,s.jsx)("button",{className:"btn",onClick:x,disabled:y||!e,children:y?"Starting...":"Start MFA Setup"})}),u&&(0,s.jsx)("div",{style:{color:"red",marginBottom:12},children:u})]}):"verify"===a?(0,s.jsxs)("div",{className:"container",style:{maxWidth:400,margin:"0 auto",padding:32},children:[(0,s.jsx)("h2",{children:"Verify MFA"}),(0,s.jsxs)("div",{style:{marginBottom:16},children:[(0,s.jsx)("div",{children:"Scan this QR code in your authenticator app:"}),(0,s.jsx)("img",{src:"https://api.qrserver.com/v1/create-qr-code/?data=".concat(encodeURIComponent(l),"&size=200x200"),alt:"MFA QR",style:{margin:"16px 0"}}),(0,s.jsxs)("div",{style:{fontSize:12,wordBreak:"break-all"},children:["Or enter secret: ",(0,s.jsx)("b",{children:r})]})]}),(0,s.jsxs)("form",{onSubmit:f,children:[(0,s.jsx)("div",{style:{marginBottom:16},children:(0,s.jsx)("input",{type:"text",placeholder:"Enter 6-digit code",value:c,onChange:e=>h(e.target.value),required:!0,pattern:"\\\\d{6}",style:{width:"100%",padding:8},autoFocus:!0})}),u&&(0,s.jsx)("div",{style:{color:"red",marginBottom:12},children:u}),(0,s.jsx)("button",{className:"btn",type:"submit",disabled:y,style:{width:"100%"},children:y?"Verifying...":"Verify & Enable MFA"})]})]}):null}}}]);
//# sourceMappingURL=355.08758003.chunk.js.map